<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PG2种子计算</title>
    <style>
      body {
        background-color: #ffffff;
      }
      textarea {
        font-family: monospace, consolas, "Courier New";
      }
      #controls {
        max-width: 500px;
        margin-bottom: 16px;
      }
      input {
        width: 7em;
      }
    </style>
  </head>
  <body>
    <div>
      <h1>PG2种子计算</h1>
      <textarea id="input" placeholder="请输入要求" cols="50" rows="15"></textarea>
      <div id="controls">
        <input onchange="input.value+=`iterateF(x, ${this.value})`" placeholder="f(x)的迭代次数" value="" />
        <button onclick="input.value+=' && '">并且</button>
        <button onclick="input.value+=' > '">大于</button>
        <button onclick="input.value+=' < '">小于</button>
        <button onclick="input.value+='dev(,,)'">约等于</button>
        <button onclick="input.value+='colorDev(f2,\'\',)'">颜色约等于</button>
        <br />
        可选：
        <input placeholder="起始值" id="start" value="0" />
        <input placeholder="枚举次数" id="maxIterations" value="1e3" />
        <input placeholder="步长" id="stepSize" value="1" />
      </div>
      <button onclick="findSolutions()">计算</button>
      <a href="index.html">回到生成器</a>
      <p id="result" style="word-break: break-all"></p>
      <hr />
      <p>注意:在计算条件时请进行放缩（因为随机数生成在0~1之间）！如若要让rotate值为200（误差正负20），请输入dev(iterateF(x, 4), 200/360 , 20/360)，在colorDev中除外</p>
      <p>一些注释</p>
      <ul>
        <li>科学计数法:给个例子就明白了:2e3 = 2*10^3 = 2000</li>
        <li>枚举次数:算多少次，范围最好小于1e6(1000000)</li>
        <li>步长:两次枚举之间种子值的间隔</li>
        <li>约等于:dev(一个值,目标值,允许的最大误差)</li>
        <li>颜色约等于:colorDev(一个值, "标准色(放在引号里面)", 允许的最大误差(0~255))</li>
        <li>f2:第二个参数，直接用</li>
      </ul>
      <p>调用顺序（对应的顺序代表f(x)的迭代次数）</p>
      <ol>
        <li>type[1|2]</li>
        <li>color[0~1]</li>
        <li>radiusPercent[0.1,0.7]</li>
        <li>rotate[0,360]</li>
        <li>detailColor[0,360]</li>
        <li>detailOpacity[0,1]</li>
        <li>detailRotate[0,360]</li>
        <li>detailSkin[0,2]</li>
        <li>atmosphereSize[0,20]</li>
        <li>ringOpacity[0|1]</li>
        <li>ringRotate[0,360]</li>
        <li>ringRotateX[60,89]</li>
        <li>ringColor[0,360]</li>
        <li>ShadowSize[-1,1]</li>
        <li>ShadowDirection[0|1]</li>
        <li>starRadiusPercent[0.03,0.1]</li>
        <li>cloudRotate[0,360]/[-10,10]</li>
        <li>cloudOpacity[0,1]</li>
        <li>starSpectrum[0,6]</li>
      </ol>
      <script>
        var condition;
        const input = document.getElementById("input");
        //#region 必要的函数定义
        f = (x) => (Math.sin(x * 9301 + 49297) % 233280) / 2 + 0.5;
        function iterateF(x, n) {
          for (let i = 0; i < n; i++) {
            x = f(x);
          }
          return x;
        }
        dev = (x, standard, maxDeviation) => Math.abs(x - standard) < maxDeviation;
        colorDev = (color, standard, maxDeviation) => {
          color = hex2rgb(color);
          standard = hex2rgb(standard);
          return dev(color[0], standard[0], maxDeviation) && dev(color[1], standard[1], maxDeviation) && dev(color[2], standard[2], maxDeviation);
        };
        hex2rgb = (x) => {
          let r = parseInt(x.slice(1, 3), 16);
          let g = parseInt(x.slice(3, 5), 16);
          let b = parseInt(x.slice(5, 7), 16);
          return [r, g, b];
        };
        //#endregion

        let solutions = [];

        // 查找满足条件的解集
        function findSolutions() {
          const start = parseFloat(document.getElementById("start").value);
          const maxIterations = document.getElementById("maxIterations").value; // 枚举次数
          const stepSize = parseFloat(document.getElementById("stepSize").value); // 步长
          for (let i = 0; i < maxIterations; i++) {
            let x = i * stepSize + start;
            let f2 = `#${iterateF(x, 2).toString(16).slice(2, 8)}`;
            var condition = eval(input.value);
            if (condition) {
              solutions.push(x);
            }
          }
          document.getElementById("result").innerHTML = "满足条件的x值有：" + solutions;
          solutions = [];
        }
      </script>
    </div>
  </body>
</html>
